<div class="order-details-dialog">
  <!-- Dialog Header -->
  <div class="dialog-header">
    <h2 class="dialog-title">
      <mat-icon>receipt</mat-icon>
      Détails de la commande {{ order?.id }}
    </h2>
    <button mat-icon-button (click)="onClose()" class="close-btn">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Chargement des détails...</p>
  </div>

  <!-- Order Details Content -->
  <div class="dialog-content" *ngIf="!isLoading && order">
    
    <!-- Order Status and Info -->
    <mat-card class="status-card">
      <mat-card-content>
        <div class="status-section">
          <div class="status-info">
            <mat-chip 
              [color]="getStatusInfo()?.color || ''" 
              class="status-chip">
              <mat-icon matChipAvatar>{{ getStatusInfo()?.icon }}</mat-icon>
              {{ getStatusInfo()?.label }}
            </mat-chip>
            <p class="status-description">{{ getStatusInfo()?.description }}</p>
          </div>
          
          <div class="order-meta">
            <div class="meta-item">
              <mat-icon>event</mat-icon>
              <span>Commandé le {{ order.createdAt | date:'dd/MM/yyyy' }}</span>
            </div>
            <div class="meta-item" *ngIf="order.pickupDate">
              <mat-icon>done_all</mat-icon>
              <span>Livré le {{ order.pickupDate | date:'dd/MM/yyyy' }}</span>
            </div>

            <div class="meta-item" *ngIf="order.estimatedDeliveryDate && !order.pickupDate && getStatusInfo()?.label !== 'Annulée'">
              <mat-icon>schedule</mat-icon>
              <span>Livraison estimée: {{ order.estimatedDeliveryDate | date:'dd/MM/yyyy' }}</span>
            </div>

          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Order Items -->
    <mat-card class="items-card">
      <mat-card-header>
        <div mat-card-avatar>
          <mat-icon>inventory</mat-icon>
        </div>
        <mat-card-title>Articles commandés</mat-card-title>
        <mat-card-subtitle>{{ order.items.length }} article{{ order.items.length > 1 ? 's' : '' }}</mat-card-subtitle>
      </mat-card-header>
      
      <mat-card-content>
        <div class="items-list">
          <div class="item-row" *ngFor="let item of order.items">
            <div class="item-image">
              <img [src]="item.image" [alt]="item.productName" onerror="this.src='assets/images/placeholder.svg'">
            </div>
            
            <div class="item-details">
              <h4 class="item-name">{{ item.productName }}</h4>
              <!-- <p class="item-sku">SKU: {{ item.sku }}</p> -->
              <div class="item-pricing">
                <span class="item-price">{{ formatPrice(getItemUnitPriceTTC(item)) }}</span>
                <span class="item-quantity">× {{ item.quantity }}</span>
                <span class="item-total">{{ formatPrice(getItemTotalPriceTTC(item)) }}</span>
              </div>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Order Summary -->
    <mat-card class="summary-card">
      <mat-card-header>
        <div mat-card-avatar>
          <mat-icon>receipt_long</mat-icon>
        </div>
        <mat-card-title>Récapitulatif</mat-card-title>
      </mat-card-header>
      
      <mat-card-content>
        <div class="summary-details">
          <div class="summary-row">
            <span>Sous-total</span>
            <span>{{ order.subtotal | currency:'EUR':'symbol':'1.2-2' }}</span>
          </div>
          
          <div class="summary-row">
            <span>Frais de livraison</span>
            <span>{{ order.shippingAmount | currency:'EUR':'symbol':'1.2-2' }}</span>
          </div>
          
          <div class="summary-row">
            <span>TVA</span>
            <span>{{ order.taxAmount | currency:'EUR':'symbol':'1.2-2' }}</span>
          </div>
          
          <mat-divider></mat-divider>
          
          <div class="summary-row total-row">
            <span>Total</span>
            <span>{{ order.totalAmount | currency:'EUR':'symbol':'1.2-2' }}</span>
          </div>
        </div>

        <div class="payment-info">
          <mat-icon>payment</mat-icon>
          <span>{{ order.paymentMethod }}</span>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Shipping Information -->
    <mat-card class="shipping-card">
      <mat-card-header>
        <div mat-card-avatar>
          <mat-icon>local_shipping</mat-icon>
        </div>
        <mat-card-title>Informations de livraison</mat-card-title>
      </mat-card-header>
      
      <mat-card-content>
        <div class="address-grid">
          <div class="address-section" *ngIf="order.shippingAddress">
            <h4>Adresse de livraison</h4>
            <div class="address">
              <p>{{ order.shippingAddress.street }}</p>
              <p>{{ order.shippingAddress.postalCode }} {{ order.shippingAddress.city }}</p>
              <p>{{ order.shippingAddress.country }}</p>
              <!-- <p *ngIf="order.shippingAddress.phone" class="address-phone">
                <mat-icon>phone</mat-icon>
                {{ order.shippingAddress.phone }}
              </p> -->
              <p  class="address-phone">
                <mat-icon>phone</mat-icon>
                07 12 34 56 78
              </p>
            </div>
          </div>
          
          <div *ngIf="order.billingAddress" class="address-section">
            <h4>Adresse de facturation</h4>
            <div *ngIf="order.billingAddress" class="address">
              <p>{{ order.billingAddress.street }}</p>
              <p>{{ order.billingAddress.postalCode }} {{ order.billingAddress.city }}</p>
              <p>{{ order.billingAddress.country }}</p>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Notes -->
    <mat-card class="notes-card" *ngIf="order.note">
      <mat-card-header>
        <div mat-card-avatar>
          <mat-icon>note</mat-icon>
        </div>
        <mat-card-title>Notes</mat-card-title>
      </mat-card-header>
      
      <mat-card-content>
        <p>{{ order.note }}</p>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Dialog Actions -->
  <div class="dialog-actions" *ngIf="!isLoading && order">
    <div class="actions-left">
      <button 
        mat-button 
        color="warn"
        (click)="onCancelOrder()"
        [disabled]="!canCancel() || isProcessing"
        *ngIf="canCancel()">
        <mat-icon>cancel</mat-icon>
        <span *ngIf="!isProcessing">Annuler la commande</span>
        <span *ngIf="isProcessing">Annulation...</span>
      </button>
    </div>
    
    <div class="actions-right">
      <button 
        mat-button 
        color="primary"
        (click)="onReorder()"
        [disabled]="!canReorder() || isProcessing"
        *ngIf="canReorder()">
        <mat-icon>refresh</mat-icon>
        <span *ngIf="!isProcessing">Racheter</span>
        <span *ngIf="isProcessing">Ajout au panier...</span>
      </button>
      
      <button mat-raised-button color="primary" (click)="onClose()">
        Fermer
      </button>
    </div>
  </div>

  <!-- Error State -->
  <div class="error-state" *ngIf="!isLoading && !order">
    <mat-icon class="error-icon">error</mat-icon>
    <h3>Commande introuvable</h3>
    <p>Impossible de charger les détails de cette commande.</p>
    <button mat-raised-button color="primary" (click)="onClose()">
      <mat-icon>close</mat-icon>
      Fermer
    </button>
  </div>
</div>
