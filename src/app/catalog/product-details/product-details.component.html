
<div class="product-details-showcase">
  <!-- Spinner de chargement -->
  <div class="loading-container" *ngIf="isLoading">
    <mat-spinner diameter="60" color="primary"></mat-spinner>
    <p class="loading-text">Chargement du produit...</p>
  </div>

  <!-- Navigation breadcrumb -->
  <div class="breadcrumb-nav" *ngIf="!isLoading && product">
    <button 
      mat-button 
      class="nav-link"
      (click)="goBack()">
      <mat-icon>home</mat-icon>
      Catalogue
    </button>
    <mat-icon class="breadcrumb-separator">chevron_right</mat-icon>
    <span class="current-page">{{ product.name }}</span>
  </div>

  <!-- Détails du produit -->
  <div class="product-showcase" *ngIf="!isLoading && product">
    <div class="product-layout">
      <!-- Section gauche - Images -->
      <div class="product-gallery">
        <div class="main-image-container">
          <!-- Badges -->
          <div class="product-badges">
            <div class="discount-badge" *ngIf="isPromotional(product)">
              <span>-{{ getDiscountPercentage(product) }}%</span>
            </div>
            <div class="urgent-badge" *ngIf="isPromotionExpiringSoon(product)">
              <mat-icon>schedule</mat-icon>
              <span>Offre limitée</span>
            </div>
          </div>

          <!-- Image principale -->
          <div class="main-image-wrapper">
            <img 
              [src]="product.imageUrls[currentImageIndex] || 'assets/images/no-image.png'"
              [alt]="product.name"
              class="main-product-image">
          </div>

          <!-- Navigation images -->
          <div class="image-controls" *ngIf="product.imageUrls.length > 1">
            <button 
              mat-mini-fab 
              color="primary"
              class="image-nav-btn prev-btn"
              (click)="previousImage()"
              [disabled]="currentImageIndex === 0">
              <mat-icon>chevron_left</mat-icon>
            </button>
            <button 
              mat-mini-fab 
              color="primary"
              class="image-nav-btn next-btn"
              (click)="nextImage()"
              [disabled]="currentImageIndex === product.imageUrls.length - 1">
              <mat-icon>chevron_right</mat-icon>
            </button>
          </div>
        </div>

        <!-- Miniatures -->
        <div class="thumbnails-gallery" *ngIf="product.imageUrls.length > 1">
          <div 
            *ngFor="let imageUrl of product.imageUrls; let i = index"
            class="thumbnail-item"
            [class.active]="i === currentImageIndex"
            (click)="selectImage(i)">
            <img [src]="imageUrl" [alt]="'Image ' + (i + 1)">
          </div>
        </div>
      </div>

      <!-- Section droite - Informations -->
      <div class="product-info-panel">
        <!-- Header produit -->
        <div class="product-header">
          <div class="product-meta">
            <mat-chip class="category-chip">
              <mat-icon>category</mat-icon>
              {{ product.category.name }}
            </mat-chip>
            <span class="product-sku">Réf: {{ product.sku }}</span>
          </div>
          
          <h1 class="product-title">{{ product.name }}</h1>
          
          <!-- Statut stock -->
          <div class="stock-status" [ngClass]="getStockStatus(product)">
            <mat-icon class="stock-icon">{{ getStockStatusIcon(product) }}</mat-icon>
            <span class="stock-text">{{ getStockStatusText(product) }}</span>
            <span class="stock-quantity" *ngIf="getStockStatus(product) !== 'out-of-stock'">
              ({{ product.stockQuantity }} disponible{{ product.stockQuantity > 1 ? 's' : '' }})
            </span>
          </div>
        </div>

        <!-- Section prix -->
        <mat-card class="price-card">
          <mat-card-content>
            <div class="price-display">
              <div class="price-main" *ngIf="isPromotional(product); else normalPriceTemplate">
                <div class="promo-prices">
                  <span class="old-price">{{ formatCurrency(product.sellingPrice) }}</span>
                  <span class="current-price-promo">{{ getPromotionalPrice(product) }}</span>
                </div>
                <div class="savings-info">
                  <mat-icon>trending_down</mat-icon>
                  <span>Vous économisez {{ formatCurrency(product.sellingPrice - (product.promotionPrice || 0)) }}</span>
                </div>
              </div>
              <ng-template #normalPriceTemplate>
                <span class="current-price">{{ formatCurrency(product.sellingPrice) }}</span>
              </ng-template>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Actions principales -->
        <div class="main-actions">
          <div class="primary-action">
            <button 
              mat-raised-button 
              color="accent"
              class="add-cart-btn"
              [disabled]="getStockStatus(product) === 'out-of-stock'"
              (click)="onProductSelect(product)">
              <div class="btn-content">
                <div class="btn-icon-wrapper">
                  <mat-icon class="btn-icon">
                    {{ getStockStatus(product) === 'out-of-stock' ? 'block' : 'shopping_cart' }}
                  </mat-icon>
                </div>
                <div class="btn-text">
                  <span class="btn-label" *ngIf="getStockStatus(product) !== 'out-of-stock'; else outOfStockText">
                    Ajouter au panier
                  </span>
                  <ng-template #outOfStockText>
                    <span class="btn-label">Produit indisponible</span>
                  </ng-template>
                  <span class="btn-sublabel" *ngIf="getStockStatus(product) !== 'out-of-stock'">
                    Livraison gratuite dès 50€
                  </span>
                </div>
              </div>
            </button>
          </div>
          
          <div class="secondary-actions">
            <button 
              mat-raised-button 
              class="wishlist-btn"
              [class.favorited]="false"
              (click)="toggleWishlist()"
              [matTooltip]="'Ajouter à mes favoris'">
              <div class="wishlist-content">
                <div class="wishlist-icon-wrapper">
                  <mat-icon class="wishlist-icon">favorite_border</mat-icon>
                </div>
                <div class="wishlist-text-container">
                  <span class="wishlist-text">Ajouter aux favoris</span>
                  <span class="wishlist-subtext">Sauvegarde pour plus tard</span>
                </div>
              </div>
            </button>
          </div>
        </div>

        <!-- Description -->
        <mat-card class="description-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>description</mat-icon>
              Description du produit
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <p class="product-description">{{ product.description }}</p>
          </mat-card-content>
        </mat-card>

        <!-- Caractéristiques -->
        <mat-card class="specs-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>list_alt</mat-icon>
              Caractéristiques
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="specs-list">
              <div class="spec-row">
                <span class="spec-label">Référence</span>
                <span class="spec-value">{{ product.sku }}</span>
              </div>
              <div class="spec-row">
                <span class="spec-label">Catégorie</span>
                <span class="spec-value">{{ product.category.name }}</span>
              </div>
              <div class="spec-row" *ngIf="product.category.description">
                <span class="spec-label">Type</span>
                <span class="spec-value">{{ product.category.description }}</span>
              </div>
              <div class="spec-row">
                <span class="spec-label">Disponibilité</span>
                <span class="spec-value" [ngClass]="getStockStatus(product)">
                  {{ getStockStatusText(product) }}
                </span>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Actions secondaires -->
        <div class="secondary-actions">
          <button 
            mat-button 
            color="primary"
            (click)="goBack()">
            <mat-icon>keyboard_arrow_left</mat-icon>
            Retour au catalogue
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Message si produit non trouvé -->
  <div class="not-found-showcase" *ngIf="!isLoading && !product">
    <mat-card class="not-found-card">
      <mat-card-content>
        <div class="not-found-content">
          <mat-icon class="not-found-icon">sentiment_dissatisfied</mat-icon>
          <h2 class="not-found-title">Produit introuvable</h2>
          <p class="not-found-message">
            Désolé, ce produit n'existe pas ou n'est plus disponible dans notre catalogue.
          </p>
          <button 
            mat-raised-button 
            color="primary"
            (click)="goBack()">
            <mat-icon>storefront</mat-icon>
            Retourner au catalogue
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
