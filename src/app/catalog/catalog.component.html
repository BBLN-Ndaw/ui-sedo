<div class="ecommerce-catalog">
  <!-- Header moderne -->
  <div class="catalog-header">
    <div class="header-content">
      <h1 class="catalog-title">
        <mat-icon class="title-icon">shopping_bag</mat-icon>
        Nos Produits
      </h1>
      <p class="catalog-subtitle">Découvrez notre sélection de produits disponibles en boutique</p>
    </div>
  </div>

  <!-- Spinner de chargement -->
  <div class="loading-section" *ngIf="isLoading">
    <mat-spinner diameter="50" color="primary"></mat-spinner>
    <p class="loading-text">Chargement des produits...</p>
  </div>

  <!-- Section Promotions en bannière -->
  <div class="promotions-banner" *ngIf="!isLoading && promotionalProductWithCategorys.length > 0">
    <div class="banner-header">
      <h2 class="promo-title">
        <mat-icon class="flash-icon">flash_on</mat-icon>
        Offres Flash
      </h2>
      <p class="promo-subtitle">Profitez de nos réductions limitées dans le temps</p>
    </div>

    <div class="promo-slider">
      <div class="promo-container">
        <div class="promo-track">
          <div 
            *ngFor="let product of promotionalProductWithCategorys; trackBy: trackByProductId" 
            class="promo-card"
            (click)="onProductView(product)">
            
            <div class="promo-image-container">
              <img 
                [src]="product.imageUrls[0] || 'assets/images/no-image.png'"
                [alt]="product.name"
                class="promo-image"
                loading="lazy">
              
              <div class="discount-label">
                -{{ getDiscountPercentage(product) }}%
              </div>
              
              <div class="urgent-label" *ngIf="isPromotionExpiringSoon(product)">
                <mat-icon>schedule</mat-icon>
                <span>Dernières heures !</span>
              </div>
            </div>

            <div class="promo-details">
              <h4 class="promo-name">{{ product.name }}</h4>
              <div class="promo-pricing">
                <span class="old-price">{{ getNormalPriceTTC(product) }}</span>
                <span class="new-price">{{ getPromotionalPrice(product) }}</span>
              </div>
              <div class="promo-stock" [ngClass]="getStockStatus(product)">
                {{ getStockStatusText(product) }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Grille produits principale -->
  <div class="products-section" *ngIf="!isLoading && productWithCategorys.length > 0">
    <div class="products-grid">
      <div 
        *ngFor="let product of productWithCategorys; trackBy: trackByProductId" 
        class="product-card"
        [class.stock-low]="getStockStatus(product) === 'low-stock'"
        [class.stock-out]="getStockStatus(product) === 'out-of-stock'">
        
        <!-- Image et badges -->
        <div class="card-image-section">
          <div class="image-container">
            <img 
              [src]="product.imageUrls[0] || 'assets/images/no-image.png'"
              [alt]="product.name"
              class="product-img"
              loading="lazy"
              (click)="onProductView(product)">
            
            <!-- Badge catégorie -->
            <div class="category-tag">
              {{ product.category.name }}
            </div>
            
            <!-- Badge stock -->
            <div class="stock-badge" [ngClass]="getStockStatus(product)" *ngIf="getStockStatus(product) !== 'in-stock'">
              <mat-icon class="badge-icon">{{ getStockStatusIcon(product) }}</mat-icon>
              <span>{{ getStockStatusText(product) }}</span>
            </div>
          </div>
        </div>

        <!-- Informations produit -->
        <div class="card-content">
          <div class="product-info">
            <h3 class="product-title" (click)="onProductView(product)" [title]="product.name">
              {{ product.name }}
            </h3>
            
            <p class="product-desc" [title]="product.description">
              {{ product.description }}
            </p>
            
            <div class="product-meta">
              <span class="sku">Réf: {{ product.sku }}</span>
              <span class="stock-info" [ngClass]="getStockStatus(product)">
                {{ product.stockQuantity }} disponible(s)
              </span>
            </div>
          </div>
          
          <!-- Prix et action -->
          <div class="card-footer">
            <div class="pricing">
              <span class="price-value">{{ formatProductPriceTTC(product) }}</span>
              <span class="price-tax">TTC</span>
            </div>
            
            <button 
              mat-raised-button 
              color="primary"
              class="add-to-cart-btn"
              (click)="onProductSelect(product)"
              [matTooltip]="getStockStatus(product) === 'out-of-stock' ? 'Indisponible' : 'Ajouter au panier'"
              [disabled]="getStockStatus(product) === 'out-of-stock'">
              <mat-icon>add_shopping_cart</mat-icon>
              {{ getStockStatus(product) === 'out-of-stock' ? 'Indisponible' : 'Ajouter' }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Message aucun produit -->
  <div class="empty-state" *ngIf="!isLoading && productWithCategorys.length === 0">
    <div class="empty-content">
      <mat-icon class="empty-icon">shopping_bag</mat-icon>
      <h2 class="empty-title">Aucun produit disponible</h2>
      <p class="empty-message">
        Notre catalogue est en cours de mise à jour. Revenez bientôt pour découvrir nos nouveaux produits !
      </p>
    </div>
  </div>
</div>
